.PHONY: pylowl-help
pylowl-help:
	@echo 'pylowl targets:'
	@echo '  pylowl:          build lib$(LOWL_LIB_SHORTNAME) Cython interface'
	@echo '  pylowl-fat:      copy dependencies to "$(PYLOWL_BLD_DIR)"'
	@echo '                   (for in-place invocation)'
	@echo '  pylowl-tests:    build and run pylowl tests'
	@echo '  pylowl-install:  install pylowl'
	@echo

PYLOWL_LIB_FILENAME := pylowl$(PY_SHLIB_SUFFIX)
PYLOWL_LIB := $(PYLOWL_BLD_DIR)/$(PYLOWL_LIB_FILENAME)

PYLOWL_PYX_FILENAME := pylowl.pyx
PYLOWL_PYX := $(PYLOWL_BLD_DIR)/$(PYLOWL_PYX_FILENAME)
PYLOWL_SOURCES := $(PYLOWL_BLD_DIR)/lowl.pxd $(PYLOWL_PYX)

$(PYLOWL_LIB): $(PYLOWL_BLD_DIR)/setup.py $(PYLOWL_SOURCES) $(LOWL_LIB)
	cd $(PYLOWL_BLD_DIR) && $(PYTHON) setup.py build_ext --inplace

.PHONY: pylowl
pylowl: $(PYLOWL_LIB)

.PHONY: pylowl-fat
pylowl-fat: $(PYLOWL_LIB)
	cp $(LOWL_LIB) $(PYLOWL_BLD_DIR)/
	cp $(PYLOWL_SRC_DIR)/run.sh $(PYLOWL_BLD_DIR)/

.PHONY: pylowl-tests
pylowl-tests: pylowl-fat
	cd $(PYLOWL_BLD_DIR) && bash run.sh $(PYTHON) -m doctest --doctest-extension=pyx -v $(PYLOWL_PYX_FILENAME)

.PHONY: pylowl-install
pylowl-install: $(PYLOWL_LIB)
	cd $(PYLOWL_BLD_DIR) && $(PYTHON) setup.py install $(DISTUTILS_INSTALL_FLAGS)
