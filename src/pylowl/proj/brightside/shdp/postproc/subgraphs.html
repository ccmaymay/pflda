<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<style>

body {
    font: sans-serif;
}

.node {
}

.graph_container {
    float: left;
    padding: 10px;
}

#inputWindowParameters {
    border: 1px solid black;
	position: fixed;
	right: 0;
	top: 0;
    background-color: rgba(255,255,255,.85);
    padding: 10px;
}
</style>

</head>
<body>

<div>
	<div id="inputWindowParameters">
    <div><a href="graph.html">graph</a></div>
	</div>
</div>

<div id="graphs_container">
</div>

<script src="d3.v3.js"></script>

<script>


var graph_length = function(node) {
    var nested_node = node;
    for (var n = 0; nested_node.children.length > 0; ++n) {
        nested_node = nested_node.children[0];
    }
    return n;
}

var lookup_node = function(node, n) {
    var nested_node = node;
    for (var j = 0; j < n; ++j) {
        nested_node = nested_node.children[0];
    }
    return nested_node
}


d3.json("graph.json", function(error, graph_root) {
    d3.json("subgraphs.json", function(error, root) {
        var color_ramp = d3.scale.linear().domain([0,1]).range(["#fff","#c0c"]);

        var node_size = 20;
        var M = root.length;
        var K = graph_length(graph_root) + 1;
        var J = graph_length(root[0]["sublist"]) + 1;

        var svg_width = (J + 1) * node_size;
        var svg_height = (K + 1) * node_size;

        for (var m = 0; m < M; ++m) {
            var graph_container = document.createElement("div");
            graph_container.className = "graph_container";
            graphs_container.appendChild(graph_container);

            var klass = root[m]["class"];
            var class_container = document.createElement("div");
            graph_container.appendChild(class_container);
            var class_text = document.createTextNode(klass);
            class_container.appendChild(class_text);

            var inner_graph_container = document.createElement("div");
            graph_container.appendChild(inner_graph_container);

            var svg = d3.select(inner_graph_container).append("svg")
                    .attr("width", svg_width)
                    .attr("height", svg_height)
                .append("g")
                    .attr("transform", "translate(0,0)");

            var rect = svg.selectAll(".node")
                    .data(d3.range(0, J*K))
                .enter().append("rect")
                    .attr("class", "node")
                    .attr("width", node_size)
                    .attr("height", node_size)
                    .attr("x", function(d) { return (d % J) * node_size; })
                    .attr("y", function(d) { return Math.floor(d / J) * node_size; });

            rect.style("stroke", "#cac")
                .style("fill", function(d) {
                    var j = (d % J);
                    var k = Math.floor(d / J);
                    node = lookup_node(root[m]["sublist"], j);
                    return color_ramp(node.zeta[k]);
                });
        }
    });
});

</script>

</body>
</html>
